{% extends "harvester/base.html" %}
{% block content %}

<div class="container">

    <ul class="nav nav-pills">
        <li role="presentation" {%if view.filter == "none"%}class="active"{%endif%}><a href="?filter=none">Alla</a></li>
        <li role="presentation" {%if view.filter == "delivered"%}class="active"{%endif%}><a href="?filter=delivered">Levererade</a></li>
        <li role="presentation" {%if view.filter == "not_delivered"%}class="active"{%endif%}><a href="?filter=not_delivered">Kommande</a></li>
        <li role="presentation" {%if view.filter == "not_delivered7"%}class="active"{%endif%}><a href="?filter=not_delivered7">Kommande (närmaste veckan)</a></li>
    </ul>

    <div id="d-list">

        <table id="data-table" class="table data-table" cellspacing="0">
            <thead>
                <tr>
                    <th style="width:10em">Kund</th>
                    <th style="width:10em">Önskat leveransdatum</th>
                    <th>Levererat datum</th>
                    <th>Grödor</th>
                    <th style="width:10em"></th>
                </tr>

            </thead>
            <tbody>
            {% for delivery in object_list %}

                <tr>

                    <td class="customer"><a href="{% url 'delivery-edit' delivery.id %}">{{ delivery.customer}}</a></td>
                    <td class="date">{{delivery.target_date}}</td>
                    <td class="date">
                    {%if delivery.delivery_date %}
                        {{delivery.delivery_date }}
                        <a href="{%url "delivery-spec" delivery.pk%}"><span class="glyphicon glyphicon-print"></span> </a>
                        {%else %}
                            -
                        {%endif%}

                    </td>
                    <td class="crop">
                        {% for i in delivery.deliveryitem_set.all %}
                            {%if i.pk%}
                                <a class="" role="button"
                                   href="{%url "delivery-edit-harvests" i.pk request.get_full_path|urlencode:"" %}" >

                                <div id="harvest-button-{{i.pk}}" data-id="{{i.pk}}"
                                     data-query-url="{% url 'deliveries_harvest_for_delivery' %}"
                                     style="margin-right:1em;display:inline;width:auto;padding-left:5px;padding-right:5px">
                                    {{i.cropform.crop.crop}}
                                    <span class="harvested">0</span>/<span class="target">0</span> <span class="unit">kg</span>
                                </div>
                                </a>



                            {%endif%}
                            <script>
                                {%if i.pk%}
                                $( document ).ready(function() {
                                    reload_harvest_button("harvest-button-{{i.pk}}");
                                    })
                                    {%endif%}

                            </script>
                        {% endfor %}
                    </td>

                    <td>
                        <a data-toggle="confirmation" data-title="Ta bort leverans?" data-href="{%url "delivery-delete" delivery.pk %}"> <span class="glyphicon glyphicon-trash"></span></a>
                        <a href="{% url 'delivery-edit' delivery.id %}"><span class="glyphicon glyphicon-pencil"></span></a> <!--TODO: länk till redigera  -->


                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>



</div>
{% endblock %}